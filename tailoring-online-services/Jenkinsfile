pipeline {
    agent any

    tools {
        maven 'mvn'
    }

    stages {
        stage('Checkout Source Code from Git Repository') {
            steps {
                script {
                    echo 'Fetching the latest source code from the Git repository...'
                }
                git branch: 'main',
                    credentialsId: '8f1de731-7401-44dd-aa00-21e55ee42ab9',
                    url: 'https://github.com/YassineOularbi/FILL-ROUGE-TAILORING-ONLINE.git'
            }
        }

        stage('Maven Build') {
            parallel {

                stage('Clean Project') {
                    steps {
                        script {
                            echo 'Cleaning project...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn clean'
                        }
                    }
                }

                stage('Resolve Dependencies and Prepare Environment') {
                    steps {
                        script {
                            echo 'Resolving project dependencies and setting up the Maven environment...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn dependency:resolve'
                        }
                    }
                }

                stage('Validate Project Configuration') {
                    steps {
                        script {
                            echo 'Validating project configuration to ensure integrity...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn validate'
                        }
                    }
                }

                stage('Compile Application Source Code') {
                    steps {
                        script {
                            echo 'Compiling the source code of the application...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn clean compile'
                        }
                    }
                }

                stage('Compile Test Classes') {
                    steps {
                        script {
                            echo 'Compiling test classes for unit testing...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn test-compile'
                        }
                    }
                }

                stage('Execute Unit Tests') {
                    steps {
                        script {
                            echo 'Executing unit tests to verify code correctness...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn test'
                        }
                    }
                }

                stage('Run Integration Tests') {
                    steps {
                        script {
                            echo 'Executing integration tests to validate system behavior...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn integration-test'
                        }
                    }
                }

                stage('Perform Project Verification') {
                    steps {
                        script {
                            echo 'Running Maven verification phase to ensure all checks are passed...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn verify'
                        }
                    }
                }

                stage('Package the Application') {
                    steps {
                        script {
                            echo 'Packaging the application into a deployable artifact (JAR/WAR)...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn package'
                        }
                    }
                }

                stage('Install Package to Local Repository') {
                    steps {
                        script {
                            echo 'Installing the packaged application into the local Maven repository...'
                        }
                        dir('tailoring-online-services') {
                            sh 'mvn install'
                        }
                    }
                }
            }
        }
    }

    post {
        always {
            script {
                echo 'Cleaning up the workspace after the build...'
            }
            cleanWs()
        }
        success {
            script {
                echo 'Pipeline completed successfully. All stages passed.'
            }
        }
        failure {
            script {
                echo 'Pipeline failed. Please check the logs for details.'
            }
        }
    }
}
